<!DOCTYPE html>
<html>
<head>
<meta charset="utf8">
<title>Compiler Development</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<style type="text/css">
	pre output:first-child { padding-top: 0; }
</style>
</head>
<body>

<div class="container-fluid">
	<div class="row">
		<section class="col-sm-8 col-sm-offset-2">
			<h2>File Path</h2>
			<div class="input-group">
				<input id="input" type="text" class="form-control" value="test.kit" readonly>
				<div class="input-group-btn">
					<button id="submit" class="btn btn-primary"><i class="fa fa-check"></i> Go</button>
				</div>
			</div>
		</section>
		<section class="col-sm-8 col-sm-offset-2">
			<h2>File Contents</h2>
			<pre><output id="source"></output></pre>
		</section>
		<section class="col-sm-8 col-sm-offset-2">
			<h2>Compiler Result</h2>
			<pre><output id="result"></output></pre>
		</section>
	</div>
</div>
	
<div id="scripts">
<script type="text/javascript" src="compiler.js"></script>
<script type="text/javascript">
	// the elements
	var $input  = document.querySelector('#input')
	var $submit = document.querySelector('#submit')
	var $source = document.querySelector('#source')
	var $result = document.querySelector('#result')
	
	// the file
	var file = {
		  path: $input.value
		, contents: ''
		, error: false
	}
	
	// get the file
	getFile($input.value).then(
		  function (response) {
			file.contents = response
			$submit.onclick()
		}
		, function (error) {
			file.error = true
			file.contents = error
		}
	)
	
	// submit
	$submit.onclick = function () {
		$source.innerHTML = file.contents.replace(/</g, '&lt;').replace(/>/g, '&gt;')
		$result.innerHTML = compile(file).compiledCode ? compile(file).compiledCode.replace(/</g, '&lt;').replace(/>/g, '&gt;') : compile(file).resultMessage
	}
	
	// getFile
	function getFile(path) {
		return new Promise(function (resolve, reject) {
			var request = new XMLHttpRequest()
			request.open('GET', path)
			request.onload = function() {
				if (request.response)
					resolve(request.response)
				else
					reject('Request goofed.')
			}
			request.onerror = function() {
				reject(Error('Network Error'))
			}
			request.send()
		})
	}
</script>
</div>

</body>
</html>
